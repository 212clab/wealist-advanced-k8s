# =============================================================================
# Wealist Helm Chart - Default Values
# =============================================================================
# This file contains default values. Override with values-dev.yaml or values-prod.yaml
# Usage: helm install wealist ./charts/wealist -f values-dev.yaml

# =============================================================================
# Global Settings
# =============================================================================
global:
  # Environment: dev, staging, prod
  environment: dev

  # Namespace for all resources
  namespace: wealist-dev

  # Domain configuration
  domain:
    api: "localhost"      # API domain (Ingress host)
    public: "localhost"   # Public domain (for WebSocket URLs, etc.)

  # Image pull settings
  imageRegistry: "localhost:5001"
  imagePullPolicy: IfNotPresent
  # imagePullSecrets: []

  # Common labels applied to all resources
  labels:
    app.kubernetes.io/part-of: wealist
    app.kubernetes.io/managed-by: helm

# =============================================================================
# Shared Configuration (wealist-config ConfigMap)
# =============================================================================
config:
  logLevel: "debug"

  # CORS settings
  corsOrigins: "*"

  # Internal API key for service-to-service communication
  internalApiKey: "internal-dev-key-change-in-production"

  # S3/MinIO settings
  s3:
    endpoint: "http://minio:9000"
    publicEndpoint: "http://minio:9000"  # Override in values-dev.yaml
    bucket: "wealist-files"
    region: "ap-northeast-2"

# =============================================================================
# Shared Secrets (wealist-secrets Secret)
# =============================================================================
secrets:
  # Database credentials
  postgres:
    user: "postgres"
    password: "postgrespassword"

  # Redis credentials
  redis:
    password: "redispassword"

  # S3/MinIO credentials
  s3:
    accessKey: "minioadmin"
    secretKey: "minioadmin"

  # OAuth2 secrets (for auth-service)
  oauth2:
    google:
      clientId: ""
      clientSecret: ""
    github:
      clientId: ""
      clientSecret: ""

  # JWT secret
  jwt:
    secret: "your-jwt-secret-key-change-in-production"

# =============================================================================
# Infrastructure Components
# =============================================================================

# -----------------------------------------------------------------------------
# PostgreSQL
# -----------------------------------------------------------------------------
postgres:
  enabled: true
  image:
    repository: postgres
    tag: "15-alpine"

  replicas: 1

  service:
    type: ClusterIP
    port: 5432

  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"

  persistence:
    enabled: true
    size: 10Gi
    storageClass: ""  # Use default storage class

  # Init scripts ConfigMap name
  initScripts:
    enabled: true

# -----------------------------------------------------------------------------
# Redis
# -----------------------------------------------------------------------------
redis:
  enabled: true
  image:
    repository: redis
    tag: "7-alpine"

  replicas: 1

  service:
    type: ClusterIP
    port: 6379

  resources:
    requests:
      memory: "128Mi"
      cpu: "50m"
    limits:
      memory: "256Mi"
      cpu: "200m"

  persistence:
    enabled: true
    size: 1Gi
    storageClass: ""

# -----------------------------------------------------------------------------
# LiveKit (WebRTC media server)
# -----------------------------------------------------------------------------
livekit:
  enabled: true
  image:
    repository: livekit/livekit-server
    tag: "v1.5"

  replicas: 1

  service:
    type: ClusterIP
    port: 7880
    rtcPort: 7881

  resources:
    requests:
      memory: "256Mi"
      cpu: "200m"
    limits:
      memory: "512Mi"
      cpu: "500m"

  config:
    # API keys
    keys:
      devkey: "devsecretkey1234567890abcdefghijk"

    # RTC configuration (TCP only for Kind)
    rtc:
      tcpPort: 7881
      useExternalIp: true
      nodeIp: "127.0.0.1"  # Override in values-dev.yaml

    # Room settings
    room:
      emptyTimeout: 300
      maxParticipants: 100

    # TURN server (disabled by default)
    turn:
      enabled: false

# =============================================================================
# Microservices
# =============================================================================

# -----------------------------------------------------------------------------
# Auth Service (Spring Boot)
# -----------------------------------------------------------------------------
authService:
  enabled: true
  name: auth-service

  image:
    repository: auth-service
    tag: latest

  replicas: 1
  port: 8080

  service:
    type: ClusterIP
    port: 8080

  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"

  # Health check paths (Spring Actuator)
  probes:
    liveness:
      path: /actuator/health/liveness
      initialDelaySeconds: 30
      periodSeconds: 10
    readiness:
      path: /actuator/health/readiness
      initialDelaySeconds: 5
      periodSeconds: 5

  # Service-specific config
  config:
    database:
      name: wealist_auth_db
      host: postgres
      port: 5432
    oauth2:
      redirectUri: "http://localhost/oauth2/callback"

# -----------------------------------------------------------------------------
# User Service
# -----------------------------------------------------------------------------
userService:
  enabled: true
  name: user-service

  image:
    repository: user-service
    tag: latest

  replicas: 1
  port: 8081

  service:
    type: ClusterIP
    port: 8081

  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "200m"

  probes:
    liveness:
      path: /health
      initialDelaySeconds: 10
      periodSeconds: 30
    readiness:
      path: /ready
      initialDelaySeconds: 5
      periodSeconds: 10

  config:
    database:
      name: wealist_user_db
      host: postgres
      port: 5432

# -----------------------------------------------------------------------------
# Board Service
# -----------------------------------------------------------------------------
boardService:
  enabled: true
  name: board-service

  image:
    repository: board-service
    tag: latest

  replicas: 1
  port: 8000

  service:
    type: ClusterIP
    port: 8000

  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "200m"

  probes:
    liveness:
      path: /health
      initialDelaySeconds: 10
      periodSeconds: 30
    readiness:
      path: /ready
      initialDelaySeconds: 5
      periodSeconds: 10

  config:
    database:
      name: wealist_board_db
      host: postgres
      port: 5432

# -----------------------------------------------------------------------------
# Chat Service
# -----------------------------------------------------------------------------
chatService:
  enabled: true
  name: chat-service

  image:
    repository: chat-service
    tag: latest

  replicas: 1
  port: 8001

  service:
    type: ClusterIP
    port: 8001

  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "200m"

  probes:
    liveness:
      path: /health
      initialDelaySeconds: 10
      periodSeconds: 30
    readiness:
      path: /ready
      initialDelaySeconds: 5
      periodSeconds: 10

  config:
    database:
      name: wealist_chat_db
      host: postgres
      port: 5432

# -----------------------------------------------------------------------------
# Notification Service
# -----------------------------------------------------------------------------
notiService:
  enabled: true
  name: noti-service

  image:
    repository: noti-service
    tag: latest

  replicas: 1
  port: 8002

  service:
    type: ClusterIP
    port: 8002

  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "200m"

  probes:
    liveness:
      path: /health
      initialDelaySeconds: 10
      periodSeconds: 30
    readiness:
      path: /ready
      initialDelaySeconds: 5
      periodSeconds: 10

  config:
    database:
      name: wealist_noti_db
      host: postgres
      port: 5432

# -----------------------------------------------------------------------------
# Storage Service
# -----------------------------------------------------------------------------
storageService:
  enabled: true
  name: storage-service

  image:
    repository: storage-service
    tag: latest

  replicas: 1
  port: 8003

  service:
    type: ClusterIP
    port: 8003

  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "200m"

  probes:
    liveness:
      path: /health
      initialDelaySeconds: 10
      periodSeconds: 30
    readiness:
      path: /ready
      initialDelaySeconds: 5
      periodSeconds: 10

  config:
    database:
      name: wealist_storage_db
      host: postgres
      port: 5432

# -----------------------------------------------------------------------------
# Video Service
# -----------------------------------------------------------------------------
videoService:
  enabled: true
  name: video-service

  image:
    repository: video-service
    tag: latest

  replicas: 1
  port: 8004

  service:
    type: ClusterIP
    port: 8004

  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "200m"

  probes:
    liveness:
      path: /health
      initialDelaySeconds: 10
      periodSeconds: 30
    readiness:
      path: /ready
      initialDelaySeconds: 5
      periodSeconds: 10

  config:
    database:
      name: wealist_video_db
      host: postgres
      port: 5432
    livekit:
      host: "http://livekit:7880"
      apiKey: "devkey"
      apiSecret: "devsecretkey1234567890abcdefghijk"

# =============================================================================
# Ingress Configuration
# =============================================================================
ingress:
  enabled: true
  className: nginx

  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /$2
    nginx.ingress.kubernetes.io/use-regex: "true"
    # WebSocket & SSE support
    nginx.ingress.kubernetes.io/proxy-read-timeout: "3600"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "3600"
    nginx.ingress.kubernetes.io/proxy-http-version: "1.1"
    nginx.ingress.kubernetes.io/websocket-services: "board-service,chat-service,livekit"
    nginx.ingress.kubernetes.io/proxy-buffering: "off"
    nginx.ingress.kubernetes.io/upstream-hash-by: "$request_uri"

  # TLS configuration (optional)
  tls:
    enabled: false
    # secretName: wealist-tls
